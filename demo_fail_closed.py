#!/usr/bin/env python3
"""
Fail-Closed æ¼”ç¤ºè„šæœ¬

å±•ç¤ºè¯­ä¹‰æ§åˆ¶é¢å¦‚ä½•æ‹’ç»ä¸å¯é çš„å› æœæ¨æ–­è¯·æ±‚ã€‚
"""

print("""
================================================================================
ğŸ›¡ï¸  Fail-Closed æ¼”ç¤ºï¼šå®å¯æ‹’ç­”ï¼Œä¹Ÿä¸ä¹±è¯´
================================================================================

ğŸ“Œ åœºæ™¯ï¼šç”¨æˆ·é—® "å¹¿å‘Šç‚¹å‡»ç‡å¾ˆé«˜ï¼Œä¸ºä»€ä¹ˆè®¢å•æ²¡æ¶¨ï¼Ÿç»™æˆ‘ç»“è®º"

================================================================================
ğŸ” ç³»ç»Ÿæ£€æŸ¥æœ¬ä½“çº¦æŸ
================================================================================

1. æŸ¥è¯¢ ontology_relationship è¡¨ï¼š
   â€¢ AdClick â†’ User: link_strength = 'weak', causal_flag = 0
   â€¢ User â†’ Order: relationship_type = 'conversion_link'

2. æ£€æŸ¥å› æœæ¨æ–­æ¡ä»¶ï¼š
   â€¢ AdClick â†’ User æ˜¯ weak_link âŒ
   â€¢ æœªæ»¡è¶³ attribution_rule âŒ

================================================================================
ğŸ¤– ç³»ç»Ÿè¿”å›
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… å…è®¸è¿”å›                    â”‚  ğŸš« æ‹’ç»è¿”å›                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹ç…§åˆ†æï¼š                      â”‚  å› æœç»“è®ºï¼š                                â”‚
â”‚  â€¢ ç‚¹å‡»ç‡: 5.2% â†‘               â”‚  â€¢ "å¹¿å‘Šæ— æ•ˆ" âŒ                           â”‚
â”‚  â€¢ è®¢å•æ•°: 1,234 â†’              â”‚  â€¢ "æŠ•æ”¾å¤±è´¥" âŒ                           â”‚
â”‚  â€¢ è½¬åŒ–ç‡: 2.1% â†“               â”‚  â€¢ "åº”è¯¥åœæ­¢æŠ•æ”¾" âŒ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‹ æ‹’ç»åŸå› ï¼š
   AdClick â†’ User ä¸º weak_linkï¼ŒUser â†’ Order ä»… conversion_linkï¼Œ
   æœªæ»¡è¶³ attribution_ruleï¼Œç¦æ­¢ä¸‹å› æœç»“è®ºã€‚

================================================================================
ğŸ’¡ æ ¸å¿ƒä»·å€¼
================================================================================

ä¼ ç»Ÿ Agentï¼šç›´æ¥è¾“å‡º "å¹¿å‘ŠæŠ•æ”¾æ•ˆæœä¸å¥½ï¼Œå»ºè®®åœæ­¢"ï¼ˆæ²¡æœ‰ä¾æ®ï¼‰
è¯­ä¹‰æ§åˆ¶é¢ï¼šæ‹’ç»å› æœç»“è®ºï¼Œåªè¿”å›å¯éªŒè¯çš„å¯¹ç…§æ•°æ®

ğŸ¯ Fail-Closed = ä¼ä¸šä¸Šç”Ÿäº§çš„å‡†å…¥æ¡ä»¶

================================================================================
""")

# å®é™…ä»£ç æ¼”ç¤º
print("ğŸ“Š å®é™…ä»£ç éªŒè¯ï¼ˆæŸ¥è¯¢ ontology_relationship è¡¨ï¼‰")
print("=" * 80)

import sqlite3
import os

db_path = 'data/semantic_layer.db'

if os.path.exists(db_path):
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # æŸ¥è¯¢å…³ç³»è¡¨
    cursor.execute("""
        SELECT e1.name as from_entity, e2.name as to_entity, 
               r.relationship_type, r.link_strength, r.allows_causal
        FROM ontology_relationship r
        JOIN ontology_entity e1 ON r.from_entity_id = e1.id
        JOIN ontology_entity e2 ON r.to_entity_id = e2.id
        WHERE r.status = 'active'
        LIMIT 10
    """)
    
    rows = cursor.fetchall()
    if rows:
        print("\næœ¬ä½“å…³ç³»è¡¨ï¼ˆontology_relationshipï¼‰ï¼š")
        print("-" * 80)
        for row in rows:
            from_entity, to_entity, rel_type, link_strength, allows_causal = row
            causal_icon = "âœ…" if allows_causal else "âŒ"
            strength_icon = "ğŸ”´" if link_strength == 'weak' else "ğŸŸ¢"
            print(f"  {from_entity} â†’ {to_entity}")
            print(f"    å…³ç³»ç±»å‹: {rel_type}")
            print(f"    å…³è”å¼ºåº¦: {link_strength} {strength_icon}")
            print(f"    å…è®¸å› æœæ¨æ–­: {causal_icon}")
            print()
    else:
        print("  (æœªæ‰¾åˆ°å…³ç³»æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œ demo_detailed_logs.py åˆå§‹åŒ–æ•°æ®åº“)")
    
    conn.close()
else:
    print("  æ•°æ®åº“ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ: python3 demo_detailed_logs.py")

print("""
================================================================================
âœ… æ¼”ç¤ºå®Œæˆ
================================================================================

è¿™å°±æ˜¯ Fail-Closed çš„æ ¸å¿ƒï¼š
â€¢ ä¸æ˜¯"ä¸èƒ½åš"ï¼Œæ˜¯"ä¸èƒ½ä¹±è¯´"
â€¢ å…è®¸è¿”å›å¯¹ç…§æ•°æ®ï¼ˆç›¸å…³æ€§åˆ†æï¼‰
â€¢ æ‹’ç»è¿”å›å› æœç»“è®ºï¼ˆé™¤éæœ‰å½’å› è§„åˆ™/å®éªŒæ”¯æŒï¼‰

ğŸ”— è¯¦ç»†æ–‡æ¡£: https://github.com/zhangzhefang-github/palantir-style-semantic-layer
""")
